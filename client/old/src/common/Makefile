# Use Makefiles in yahoo_cfg_dev package
ROOT=/home/y
include $(ROOT)/share/yahoo_cfg/Make.defs

LIB_NAME=ylem_Client
SHLIB_VERSION=1.0

LINC=-I. -I/usr/include
LCXXFLAGS=-ftemplate-depth-40	# Increase maximum template instantiation depth to build Boost::Spirit header

# Here parser.cc and lexer.cc must be before any other sources, for they should be generated first
#CXXSRC=parser.cc lexer.cc $(wildcard *.cc jsonc/*.cc)
CXXSRC=$(wildcard *.cc jsonc/*.cc)

LLDLIBS=-L/usr/lib -llog4cpp -lycore++ -lyconfig -ll -lcurl
#LLDLIBS=-L/usr/local/lib -lneon -lz -llog4cpp_y -lycore++ -lyconfig -lyfor -lysecure -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -lresolv -lexpat -ll

# Extra cleaning intermediate files generated by bison/flex
LCLEAN = lexer.cc lexer.d lexer.o parser.d parser.hh parser.o parser.cc

# Enable yProf macros
#LDEF+=-DYPROF_ON
#LLDLIBS+=-lyprof

include $(ROOT)/share/yahoo_cfg/Make.rules

# Do not place any rules or targets above this line

# -t  Outputs flex to output to stdout (which we redirect)
# -i  Case-insensitive lexer
lexer.cc: lexer.l
	flex -t -i $^ > $@

parser.cc: parser.y
	bison -d -o $@ $^

# Additional clean action to clean jsonc/*.d files under RHEL platform (default clean action doesn't work)
clean::
	rm -f jsonc/*.d

